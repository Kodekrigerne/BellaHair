@using BellaHair.Ports.Treatments
@using BellaHair.Presentation.WebUI.Components.Pages.Treatments
@using BellaHair.Presentation.WebUI.Components.Shared
@using System.Collections.Generic;
@using System.ComponentModel.DataAnnotations;
@using System.Linq;
@using BellaHair.Ports.Employees
@inject IEmployeeCommand EmployeeCommand
@inject ITreatmentQuery TreatmentQuery
@inject ISnackbar Snackbar

	<div class="inputs-items-container kk-container" style="border-radius: 8px">

		<h5 style="margin-top: 2px;">Vælg behandlinger</h5>
		<div style="height: 300px; overflow-y: scroll;">
		<br />

        <div class="treatments-container"> @* Container for column layout *@
            @foreach (var treatment in _treatments)
            {
					// Logic for changing layout depending on whether item is selected.
                    bool isSelected = SelectedTreatmentIds.Contains(treatment.Id);
					string itemStyle = isSelected 
						? "border: 2px solid #990dff; background-color: #f6e6fc; color: black; position: relative; cursor: pointer;" // Purple border, light purple background
						: "border: 2px solid lightgrey; background-color: white; color: black; position: relative; cursor: pointer;"; // Grey border, white background
                
                
                <div @onclick="@(() => ToggleTreatmentSelection(treatment.Id))" class="treatment-item" style="@(itemStyle)">
                    
						<div type="input" style="text-align: left;">@treatment.Name</div>
							<div>
								@if (isSelected)
								{
									<CheckedCirle/>
								}
								else
								{
									<UncheckedCircle/>
								}
							</div>

						<div class="d-flex align-items-start" style="gap: 15px">

						<div class="treatment-icon-format">
							<DurationIcon Class="treatment-list-icon"/> <p class="treatment-text">@treatment.DurationMinutes min</p>
						</div>

						<div class="treatment-icon-format">
							<p class="treatment-text">@treatment.Price.ToString("C")</p>
						</div>
					</div>

                </div>
				}
				</div>
			</div>
			</div>

@code
{
	[Parameter, EditorRequired]
	public List<TreatmentViewModel> _treatments { get; set; } = new List<TreatmentViewModel>();

	[Parameter, EditorRequired]
	public List<Guid> SelectedTreatmentIds { get; set; }

	private void ToggleTreatmentSelection(Guid treatmentId)
	{
		if (SelectedTreatmentIds.Contains(treatmentId))
		{
			// Hvis behandlingen er valgt, fjernes den fra de valgte behandlinger
			SelectedTreatmentIds.Remove(treatmentId);
		}
		else
		{
			// Hvis den ikke i forvejen er valgt, tilføjes den til de valgte behandlinger
			SelectedTreatmentIds.Add(treatmentId);
		}

		// Genindlæser/opdaterer komponentet med det valgte
		StateHasChanged();
	}

	private void ClearTreatments()
	{
		SelectedTreatmentIds.Clear();
		StateHasChanged();
	}



}
