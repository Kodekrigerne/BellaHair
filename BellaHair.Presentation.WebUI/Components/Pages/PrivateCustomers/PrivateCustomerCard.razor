@using BellaHair.Application.PrivateCustomers
@using BellaHair.Domain.PrivateCustomers
@using BellaHair.Ports.PrivateCustomers
@using BellaHair.Presentation.WebUI.Components.Shared

@inject IPrivateCustomerCommand PrivateCustomerCommand

<!-- Mikkel Dahlmann -->
<div class="privatecustomer-card">
						
	<div class="privatecustomer-avatar">
		@GetCustomerInitials(PrivateCustomer.FullName)
	</div>
	<div class="privatecustomer-details">
		<h3>@PrivateCustomer.FullName</h3>
		<div class="privatecustomer-contact-body">
			<div class="privatecustomer-contact-details">
				<PhoneIcon Class="privatecustomer-icons" />
				@PrivateCustomer.PhoneNumber
			</div>
			<div class="privatecustomer-contact-details">
				<HomeIcon Class="privatecustomer-icons" />
				@PrivateCustomer.FullAddress
			</div>
			<div class="privatecustomer-contact-details">
				<BirthdayIcon Class="privatecustomer-icons-birthday" />
				@PrivateCustomer.Birthday.ToString("d. MMMM yyyy")
			</div>
			<div class="privatecustomer-contact-details">
				<MailIcon Class="privatecustomer-icons" />
				@PrivateCustomer.Email
			</div>
			<div class="privatecustomer-contact-details">
				<VisitsIcon Class="privatecustomer-icons" />
				Antal besøg: @PrivateCustomer.Visits
			</div>
		</div>
	</div>
	<BinDeleteButton OnClick="@HandleOnDeleteClick" />
</div>
	
@code {

	[Parameter, EditorRequired]
	public required PrivateCustomerViewModel PrivateCustomer { get; set; }

	[Parameter, EditorRequired]
	public required EventCallback OnDelete { get; set; }

	private async Task HandleOnDeleteClick()
	{
		var command = new DeletePrivateCustomerCommand(PrivateCustomer.Id);
		await PrivateCustomerCommand.DeletePrivateCustomerAsync(command);
		await OnDelete.InvokeAsync();
	}

	private string GetCustomerInitials(string name)
	{
		var parts = name.Split(' ');
		return string.Concat(parts.Select(p => p.FirstOrDefault()));

	}
}
